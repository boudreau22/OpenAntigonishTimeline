<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OpenAntigonish: Capital Projects</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    
    <script type="text/javascript" src="https://unpkg.com/vis-timeline/standalone/umd/vis-timeline-graph2d.min.js"></script>
    <link href="https://unpkg.com/vis-timeline/styles/vis-timeline-graph2d.min.css" rel="stylesheet" type="text/css" />

    <style>
        /* --- Dropbox Paper Aesthetic Styles --- */
        :root {
            --bg-color: #ffffff;
            --text-color: #191919;
            --grid-line-color: #f0f0f0;
            --today-line-color: #ff4d4d;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            padding: 40px;
            margin: 0;
        }

        h1 {
            font-weight: 600;
            letter-spacing: -0.5px;
            margin-bottom: 30px;
        }

        /* Timeline Container Cleanup */
        .vis-timeline {
            border: none;
            font-family: 'Inter', sans-serif;
            font-size: 14px;
        }

        /* The Header (Dates) */
        .vis-time-axis .vis-text {
            color: #888;
            padding-top: 5px;
        }
        .vis-time-axis .vis-grid.vis-minor {
            border-color: var(--grid-line-color);
        }
        .vis-time-axis .vis-grid.vis-major {
            border-color: #e0e0e0;
        }

        /* The Left Panel (Groups) */
        .vis-labelset .vis-label {
            border-bottom: 1px solid var(--grid-line-color);
            color: var(--text-color);
            font-weight: 600;
            padding-left: 15px;
            display: flex;
            align-items: center;
        }

        /* The Items (Ranges) - Making them look like "pills" */
        .vis-item {
            border-color: transparent;
            background-color: transparent;
            font-size: 13px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05); /* Soft modern shadow */
        }

        .vis-item.vis-range {
            border-radius: 6px; /* Rounded corners */
            border: none; 
        }

        /* Content inside the range bars */
        .vis-item .vis-item-content {
            padding: 0 8px;
            font-weight: 500;
            color: white; 
        }

        /* The Moments (Points) */
        .vis-item.vis-point {
            background-color: transparent;
        }
        .vis-item.vis-dot {
            border-width: 2px;
            box-shadow: 0 0 0 2px white; /* White ring around dots */
        }

        /* Custom colored borders/backgrounds handled in JS, 
           but we set defaults to clean up standard Vis.js mess */
        .vis-item.vis-selected {
            border-color: #333;
            background-color: inherit;
            box-shadow: 0 4px 10px rgba(0,0,0,0.15);
            z-index: 999;
        }

        /* Today Marker */
        .vis-current-time {
            background-color: var(--today-line-color);
            width: 2px;
        }

        /* Tooltip styling */
        .custom-tooltip {
            background: white;
            padding: 12px;
            border-radius: 8px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.15);
            border: 1px solid #eee;
            max-width: 250px;
        }
        .tooltip-title { font-weight: 600; margin-bottom: 4px; display:block;}
        .tooltip-desc { font-size: 12px; color: #666; display:block; line-height: 1.4em;}
        .tooltip-date { font-size: 11px; color: #999; margin-top: 8px; display:block; text-transform: uppercase; letter-spacing: 0.5px;}

    </style>
</head>
<body>

    <h1>Town of Antigonish <span style="color:#999; font-weight:400;">Project Timeline</span></h1>
    <div id="visualization"></div>

    <script>
        // --- Helper: Format Data for Vis.js ---
        function processData(data) {
            let groups = new vis.DataSet();
            let items = new vis.DataSet();
            let groupCount = 0;

            // Helper to add a project
            function addProject(project, key) {
                if (!project) return;
                
                let groupId = groupCount++;
                
                // Add Group (The Row Header)
                groups.add({
                    id: groupId,
                    content: project.title,
                    order: groupId
                });

                // Add Ranges (Phases)
                if (project.phases) {
                    project.phases.forEach(phase => {
                        items.add({
                            group: groupId,
                            content: phase.name,
                            start: phase.start,
                            end: phase.end,
                            type: 'range',
                            // Styling injection directly on item
                            style: `background-color: ${project.color}; opacity: 0.85;`, 
                            title: generateTooltip(phase.name, phase.description, phase.start, phase.end)
                        });
                    });
                }

                // Add Moments (Events)
                if (project.events) {
                    project.events.forEach(evt => {
                        items.add({
                            group: groupId,
                            content: evt.name,
                            start: evt.date,
                            type: 'point',
                            style: `color: ${project.color}; border-color: ${project.color}; background-color: ${project.color};`, 
                            title: generateTooltip(evt.name, evt.description, evt.date, null)
                        });
                    });
                }
            }

            // Load your specific projects
            addProject(data.bayStreet, 'bayStreet');
            addProject(data.westStreet, 'westStreet');
            if (data.activeTrail) addProject(data.activeTrail, 'activeTrail');

            return { groups, items };
        }

        // --- Helper: Tooltip HTML generator ---
        function generateTooltip(title, desc, start, end) {
            let dateStr = new Date(start).toLocaleDateString();
            if (end) dateStr += " - " + new Date(end).toLocaleDateString();
            
            return `
                <div class="custom-tooltip">
                    <span class="tooltip-title">${title}</span>
                    <span class="tooltip-desc">${desc || ''}</span>
                    <span class="tooltip-date">${dateStr}</span>
                </div>
            `;
        }

        // --- Main Execution ---
        fetch('../src/data/town_projects.json')
            .then(response => response.json())
            .then(rawData => {
                const { groups, items } = processData(rawData);

                // Configuration options for the sleek look
                var options = {
                    stack: true, // Stack items if they overlap
                    maxHeight: '600px',
                    minHeight: '300px',
                    verticalScroll: true,
                    zoomKey: 'ctrlKey',
                    start: new Date(new Date().getFullYear(), 0, 1), // Start at beginning of this year
                    end: new Date(new Date().getFullYear(), 11, 31),
                    editable: false,
                    margin: {
                        item: 10, // Space between items
                        axis: 5
                    },
                    tooltip: {
                        followMouse: true,
                        overflowMethod: 'cap'
                    }
                };

                var container = document.getElementById('visualization');
                var timeline = new vis.Timeline(container, items, groups, options);

            })
            .catch(err => {
                console.error("Error loading data:", err);
                document.getElementById('visualization').innerHTML = "Could not load project data.";
            });
    </script>
</body>
</html>